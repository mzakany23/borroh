{% extends 'layouts/base.html' %}
{% load staticfiles %}
{% block account %}

<div class="container main-container headerOffset"> 

<div class="row">
  
   <div class="breadcrumbDiv col-lg-12">
        <ul class="breadcrumb">
          <li> <a href="index.html">Home</a> </li>
          <li> <a href="account.html">My Account</a> </li>
          <li class="active"> Add Address </li>
        </ul>
      </div>
      </div>
  
      
    
      <div class="row">
        <div class="col-lg-9 col-md-9 col-sm-7">
        
          <h1 class="section-title-inner">
          	<span><i class="fa fa-map-marker">
          	</i> Add a Credit Card </span>
          </h1>
        
          <div class="row">
          	<div style='margin-left: 15px;' class="col-lg-6 offset-1 col-md-6 col-sm-12 col-xs-12">
          		<div class="row userInfo">
          
          		<div class="panel panel-default">
 <div class="panel-heading">
     <form id='payment-form' method='POST' action="{% url 'add_card_to_stripe' %}">
     	<span class="payment-errors"></span>
     	{% csrf_token %}
      <div class="row ">
              <div class="col-md-12">
                  <input data-stripe='number' id='cc-num' name='cc-num' type="text" class="form-control" placeholder="**** **** **** ****" required>
              </div>
          </div>



     <div class="row ">
     					<input data-stripe='exp-month' id='hidden-month' type='hidden'>
     					<input data-stripe='exp-year' id='hidden-year' type='hidden'>
     					
              <div class="col-md-4 col-sm-4 col-xs-4">
                  <span data-stripe='number' class="help-block text-muted small-font"> Expiration</span>
                  <input id='cc-exp'name='month' type="text" class="form-control" placeholder="MM/YYYY" required>
              </div>

         			
        			<div class="col-md-3 col-sm-3 col-xs-3">
                  <span data-stripe='cvc' class="help-block text-muted small-font">  CCV</span>
                  <input id='cc-cvc' name='ccv' type="text" class="form-control" placeholder="CCV" required>
              </div>
		         <div class="col-md-3 col-sm-3 col-xs-3">
							<img src="{% static 'assets/ico/cvv-icon.png' %}" class="img-rounded">
		         </div>
		          </div>
    			 <div class="row">
              <div class="col-md-12 pad-adjust">
                 <input id="cc-name" name='name' type="text" class="form-control" placeholder="Name On The Card" required>
              </div>
          </div>
				     <div class="row">
					<div class="col-md-12 pad-adjust">
				    <div class="checkbox">
				    <label>
				      <input type="checkbox" checked="" class="text-muted"> Save details for fast payments <a href="#"> learn how ?</a>
				    </label>
				  </div>
				</div>
     		</div>
       <div class="row ">
            <div class="col-md-6 col-sm-6 col-xs-6 pad-adjust">
            	<button type='submit' class='btn btn-default'>Add Card to Stripe</button>  

            </div> 

          </div>
            </div>
          </div>

          </form>
     			
         
			        <div class="col-lg-12 col-xs-12  clearfix ">
			            <ul class="pager">
			          <li class="previous pull-right"><a href="{% url 'home' %}"> <i class="fa fa-home"></i> Go to Shop </a></li>
			          <li class="next pull-left">
			          	<a href="{% url 'show_address' %}">&larr; Back to My Address</a>
			          </li>
			          </ul>
			       </div>
        </div><!--/row end-->
          
       
        </div>
         <div class="col-lg-3 col-md-3 col-sm-5">
         </div>
         
         
      </div><!--/row-->
      
      

  <div style="clear:both"></div>
</div>
<!-- /wrapper --> 

<div class="gap"> </div>

<script type="text/javascript" src="https://js.stripe.com/v2/"></script>
<script type='text/javascript' src="https://code.jquery.com/jquery-2.1.3.js"></script>
<script type="text/javascript">
  Stripe.setPublishableKey('{{ settings.API_KEY2 }}');
</script>

<script type="text/javascript">
    $(function(){
      $('#cc-num').payment('formatCardNumber');
      $('#cc-exp').payment('formatCardExpiry');
      $('#cc-cvc').payment('formatCardCVC');
     	
     $('#cc-num').change(function(){
     	var validateCardNumber = $.payment.validateCardNumber($('#cc-num').val());
     	isValidated(validateCardNumber,'#cc-num')     	
     });

     $('#cc-name').change(function(){
     	$('#cc-name').css("background-color", "#BAEB92");
     });

     $('#cc-exp').change(function(){
     		var str = String($('#cc-exp').val());
     		var date = str.split('/')
     		var validateCardExpiry = $.payment.validateCardExpiry(date[0],date[1]);
     		isValidated(validateCardExpiry,'#cc-exp')
     		$('#hidden-month').val(parseInt(date[0]))
				$('#hidden-year').val(parseInt(date[1]))
     });

     $('#cc-cvc').change(function(){
     		var validateCardCVC = $.payment.validateCardCVC($('#cc-cvc').val());
     		isValidated(validateCardCVC,'#cc-cvc')
     });
     
    

     function isValidated(result,target){
     		if(result == true){
     			$(target).css("background-color","#BAEB92");
     		}
     		else{
     			$(target).css("background-color","#FF6565");
     		}
     }
    });
		
			function stripeResponseHandler(status, response) {
			  var $form = $('#payment-form');

			  if (response.error) {
			    // Show the errors on the form
			    $form.find('.payment-errors').text(response.error.message);
			    $form.find('button').prop('disabled', false);
			  } else {
			    // response contains id and card, which contains additional card details
			    var token = response.id;
			    // Insert the token into the form so it gets submitted to the server
			    $form.append($('<input type="hidden" name="stripeToken" />').val(token));
			    // and submit
			    $form.get(0).submit();
			  }
			};

    $('#payment-form').submit(function(event) {
    var $form = $(this);

    // Disable the submit button to prevent repeated clicks
    $form.find('button').prop('disabled', true);

    Stripe.card.createToken($form, stripeResponseHandler);

    // Prevent the form from submitting with the default action
    return false;
  });	
</script>


{% endblock %}